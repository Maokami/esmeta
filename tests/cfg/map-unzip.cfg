// input: Map, output: List[keySet of Map, ValueSet of Map]
def unzip(map: Map) {
  1: {
    let keys = (keys map)[#1]
    let ckeys = (copy keys)[#1]
    let values = (new [])[#1]
  } -> 2
  2: loop[repeat] (! (= ckeys.length 0)) then 3 else 4
  3: {
    let key = (pop < ckeys)
    let value = map[key]
    push value > values
  } -> 2
  4: let pair = (new [keys, values])[#1] -> 5
  5: return pair
}

1: let map = (new Map(1 -> "a", 2 -> "b", 3 -> "c"))[#1]
2: call pair = clo<unzip>(map)
3: {
  assert (contains pair[0] 1)
  assert (contains pair[0] 2)
  assert (contains pair[0] 3)
  assert (contains pair[1] "a")
  assert (contains pair[1] "b")
  assert (contains pair[1] "c")
}
  
